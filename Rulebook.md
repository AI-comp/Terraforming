Rule book of Terraforming
=

## Terraforming

### 目次

* ストーリー
* 概要
    * プレイ人数
    * ゲーム概要
* Materialとは
* フィールド
    * Wasteland / 荒野
    * Settlement / 開拓地
    * City / 都市
    * Hole / 穴
* ゲームの目的
    * 終了条件
    * 勝敗
* ゲームの進行
    * 初期状態
    * 侵攻コマンド
    * 建造コマンド
    * 終了コマンド
* 建造レシピ
    * 移動系
        * 橋
    * ロボット系
        * シールド
        * 攻撃塔
        * ロボット製造工場
    * Material系
        * 採掘装置
    * 得点系
        * 公園
        * 広場
        * 公共施設
* AI作成上のルール
    * 制限時間
    * 入力仕様

#### 注意
* ルール、テキストは開発中のため、大幅に変更される可能性があります。

### ストーリー
　小惑星探査採掘ロボット”Asterobots”は効率よく小惑星を採掘するための人工知能をプログラミングコンペティションJavaChallenge2012によって公募したことが話題を呼んだ。これによって実用化されたAsterobotは数多の成果を上げ、小惑星についての研究は急速に進むことになった。  
　中でも一番の成果は小惑星内のMaterialが豊富であることにより、小惑星を人の住める環境にするTerraformingが現実味を帯びてきたことである。その結果、小惑星を観光地にしてほしいという要望が高まった。  
　そこで今度は、小惑星にあるMaterialを使って与えられたレシピを元に建物を配置し、都市を作成するロボットの人工知能をプログラミングコンペティションCEDEC CHALLENGE 2013で公募することを決定した。  
　果たして今度もロボットは期待通りの成果が出せるのだろうか？

### 概要
#### プレイ人数
3人(固定)
### ゲーム概要
プレイヤーはロボットを操作して侵攻もしくは建造を行い、小惑星の開発を行う。敵対するプレイヤーより多くの土地の開発を行うことがこのゲームの最終目標である。
### Materialとは
asterobotの開発によって、小惑星内に豊富に存在することが分かった資源の総称である。  
今回は、都市開発のために建造コマンド(マスに建物を建てるコマンド。詳細は後述)に用いられる。  
荒野にも存在はしているが、自分の開拓地となっているエリア以外から採掘を行うことは禁止されている。  
(荒野、開拓地に関しては、下の「フィールド」の項目を参照)
### フィールド
正六角形127マスを、一辺を7個とする正六角形の形に敷き詰めて使用する。フィールドの座標系は中心を原点とし以下のように設定されている(図では、簡単のため一辺を3個としてある)。  
![Field_Axis](rulebook/Terraforming_field5.png)  
それぞれのマスは4つの状態に分かれており、どの状態にあるかでロボットの侵攻及び建物の建造が行えるかどうかが変化する。

* __Wasteland / 荒野__

    以前Asterobotによって採掘が行われた未整備の土地であり、今回のゲームの初期状態。この状態のマスにロボットが進入すると、マスが占領され下の開拓地に変化する。

* __Settlement / 開拓地__

    プレイヤーによって占領された土地。各マスにはMaterialが1個存在する。敵対するプレイヤーの開拓地にはロボットを進入させることで侵略することができる。ロボットがいるこの状態のマスに対して建造コマンドを実行すると、建物が建ち下の都市に変化する。

* __City / 都市__

    プレイヤーが建造コマンドによって建物を建てた後の土地。すべていずれかのプレイヤーの所有物であり、敵対するプレイヤーの都市にはロボットを進入させることはできない。

* __Hole / 穴__

    フィールドに15個程度存在する障害物。ロボットが進入することはできるが、進入すると穴に落ちたことになりそれ以降移動できなくなる。橋(後述)を建造すると建造したプレイヤーの都市となり、そのマスに存在するロボットは移動ができるようになる。穴には橋のみ建造することができる。

|未占領チームによる侵攻|占領チームによる建造|種類                   |
|:--------------------:|:------------------:|:----------------------|
|○                    |×                  |荒野 : Wasteland       |
|○                    |○                  |開拓地 : Settlement|
|×                    |×                  |都市 : City|
|△                    |△                  |穴 : Hole              |

*穴には侵攻することができるが、橋を建造しないと出ることはできない。また、穴にはいずれかのプレイヤーの橋だけを建造することができる。

### ゲームの目的

#### 終了条件

以下の条件のいずれかを満たしたとき、ゲーム終了となる。

1. マップに存在するマスがすべていずれかのプレイヤーの都市となる
1. 規定のターン数が経過する

#### 勝敗
以下のルールに基づいて点数を計算し、最も点数の高いプレイヤーを勝者とする。

1. 公共施設(後述) → 1棟につき10点
1. 都市 → 1マスにつき3点
1. 開拓地 → 1マスにつき1点

### ゲームの進行
#### 初期状態
各プレイヤーの初期位置及び穴の位置は以下の方法でランダムに決定される。

1. マップの3分の1をランダム生成（穴や初期位置1箇所）
1. 生成したものを複製して残りの3分の2を生成
1. 対称的なマップの完成

初期位置となったマスは各プレイヤーの都市となり、毎ターン開始時にそこから5台のロボットが生成される。

#### ターンの流れ

1. ターン開始時処理
    1. プレイヤーの本拠地及び所有するロボット製造工場マスに規定の数のロボットを追加
    1. シールド(後述)の効果範囲内にいる自分のロボットの数を半減させる
1. 行動
    1. 侵攻コマンドを行うか建設コマンドを行うかの選択
    1. 選択後、実際のコマンドを入力
    1. finishコマンドで終了させることができる
1. ターン終了時処理
    1. シールドの効果範囲内にいる自分のロボットの数を倍増させる
    1. 攻撃塔(後述)の攻撃範囲内にいるうちで一番近い敵ロボットを一定割合で減少させる

#### 侵攻コマンド(move)
侵攻コマンドでは、すべてのロボットを1ターンに1マス動かすことができる。  
ロボットは荒野、操作するプレイヤーの開拓地または都市、敵対するプレイヤーの開拓地、穴のいずれかに向かって移動させることができる。  
荒野に進入した場合、そのマスは占領され自分の開拓地になる。  
自分の開拓地および都市に侵入した場合、何も起こらずロボットの数だけが変化する。  
敵の開拓地に侵攻した場合、自分のロボットと敵のロボットは戦闘を行い消滅する。  
戦闘後に自分のロボットが残っていた場合、もしくは敵のロボットが0体のマスに侵攻した場合は、そのマスは自分の開拓地になる。同じマスに複数のロボットを侵攻させた場合は差し引き分が残る。  
穴に進入した場合、そのマスに入ったロボットは移動することができなくなる。敵対するプレイヤーの開拓地と同様に、敵のロボットがいる穴に侵攻すると戦闘が行われロボットが消滅する。

#### 建造コマンド(build)
建造コマンドでは、自分の開拓地(橋のみ、自分のロボットが存在している穴)にロボットを消費することで建物を建てて都市へと変化させ、建てた建物に応じた様々な効果を得ることができる。  
建造コマンドは、自分の開拓地に対してのみ実行することができる。また、建物をグレードアップすることはできない。  
消費するロボット数は建物によって異なり、建造する際には消費数より多いロボットが建造地となるマスに存在していなければならない。  
また、建造することができるのは、建造地となるマスおよびそれに隣接したマスのうち、自分の開拓地となっているマスにあるMaterialの個数の合計以下のコストを持つ建物である。  
例えば下図の中央に建物を建てるとき、このマスと隣接したマスのうち、自分の開拓地となっているマス(ピンク色で示したマス)は5つあり、Materialの合計は6であるため、6コスト以下の建物を建造することができる。  
![Material](rulebook/material.png)  
建造を行ってもMaterialは消費されない(厳密には、建造を行ったマスは都市へと変化するためそのマスのMaterialは消失する)。

#### 終了コマンド(finish)
全ての行動を入力した後、一度だけ入力することができる。  
終了コマンドを入力すると、そのターンの行動は終了したことになり、処理が行われて別のプレイヤーへと行動権が移る。

### 建造レシピ
建物の隣にある「xコスト/y体」という表記は、それぞれ必要なMaterial数、消費するロボット数を表す。
#### 移動系

* __橋__ 4コスト/10体

    穴を自分の都市に変更する。橋を建造する場合、建造地となるマスは自分の開拓地ではなく自分のロボットが存在する穴でなければならない

#### ロボット系

* __シールド__ 6コスト/25体

    周囲1マスの自分の所有しているロボットの数は自分のターンの終了時に2倍になり開始時に1/2になる  
    結果として、周囲にいる自分のロボットは戦闘時に消滅する数が半分になる

* __攻撃塔__ 5コスト/25体

    自分のターンの終了直後、攻撃塔から5マス以内で最も近いマスにいる敵ロボットの数が10%(最低でも1体は)減る（同じ距離のマスだったら？）

* __ロボット工場__ 4コスト/50体

    毎ターン開始時にそこからロボットを1つ生成する

#### Material系

* __採掘装置__ 5コスト/20体

    隣接した自分の開拓地のMaterialが1個増える

#### 得点系

* __公園__ 4コスト/1体

    建造したマスを都市に変更する

* __広場__ 9コスト/1体

    建造したマスと周囲1マスの自分の開拓地を都市に変更する

* __公共施設__ 19コスト/1体

    建造すると1棟につき勝利点10点を獲得する。建造したマスと周囲2マスの自分の開拓地を都市に変更する

### AI作成上のルール
#### ゲーム本体とAIプログラムの動作プロセス
1. ゲーム本体がゲームを初期化
1. ゲーム本体がゲーム状態をAIプログラム1に入力
1. AIプログラム1はプレイヤー名を出力
1. ゲーム本体がゲーム状態をAIプログラム2に入力
1. AIプログラム2はプレイヤー名を出力
1. ゲーム本体がゲーム状態をAIプログラム3に入力
1. AIプログラム3はプレイヤー名を出力
1. ゲーム本体がゲーム状態をAIプログラム1に入力
1. AIプログラム1は1ターン目のコマンド列を出力
1. ゲーム本体がゲーム状態をAIプログラム2に入力
1. AIプログラム2は1ターン目のコマンド列を出力
1. ゲーム本体がゲーム状態をAIプログラム3に入力
1. AIプログラム3は1ターン目のコマンド列を出力
1. ゲームが終了するまで手順8-13を繰り返す

#### 入力仕様
AIに対するフィールドの情報は以下の形式で与えられる。

    START
    ターン番号 最大ターン番号 プレイヤーのID
    フィールドの幅 タイルの数
    タイル1のx座標 y座標 所有者のID ロボットの数 資源数 建物
    タイル2のx座標 y座標 所有者のID ロボットの数 資源数 建物
    ...
    タイルnのx座標 y座標 所有者のID ロボットの数 資源数 建物
    EOS

タイルの所有者がいない場合は「所有者のID」が-1、タイルが穴である場合は「建物」がholeになる。

#### プレイヤー名の出力方法
SampleAIというプレイヤー名を出力したい場合は、標準出力へ以下の内容を出力する。
ただし、末尾には改行コードを付与すること。

    SampleAI

#### コマンド列の出力方法

座標(2, 3)に位置するロボット2体を左に動かしてターンを終了する場合は、標準出力へ以下の内容を出力する。
ただし、末尾には改行コードを付与すること。

    move 2 3 l 2
    finish

以下のようにfinishを複数回出力した場合は、次のターンのコマンド内容が街を建設するコマンドになる。
なお、複数回のbuildコマンドおよびmoveとbuildコマンドの混合は認められないため、家を建設するコマンドは無視される。

    move 2 3 l 2
    finish
    build 1 2 town
    build 2 3 house
    finish


#### ゲーム開始時の制限時間
各プレイヤーは5000msの間にゲームの初期状態を受け取ってプレイヤー名を決定しなければならない。
5000msを超えた場合はプレイヤー名が"nanashi"になり失格となる。
なお、ゲームの初期状態には開始時のマップ情報が含まれているため、名前を決める際に戦略を練っても良い。

#### ゲーム開始後の制限時間
各プレイヤーは1ターンにつき1000msの間に全てのコマンドを入力しなければならない。
1000ms以内に入力が終了しなかった(finishコマンドが入力されなかった)場合、1ゲーム以内で合計5000msまでの時間超過が認められる。
超過時間が合計で5000msを超えた場合、以降の入力は全てfinishコマンドのみと見なされ、一切コマンド入力ができなくなる。

=======
